"use strict";var modal=document.querySelector(".modal"),overlay=document.querySelector(".overlay"),body=document.querySelector("body"),commentsCtn=document.querySelector(".allCommentCtn"),userImgEl=document.querySelector("#currentUserImg"),openModal=function(e){modal.classList.add("fade-in"),overlay.classList.add("fade-in"),modal.style.display="block",overlay.style.display="block",body.classList.toggle("no-scroll"),overlay.addEventListener("click",closeModal)},closeModal=function(){modal.classList.add("fade-out"),overlay.classList.add("fade-out"),body.classList.toggle("no-scroll"),setTimeout((function(){modal.style.display="none",overlay.style.display="none",modal.classList.remove("fade-out"),overlay.classList.remove("fade-out")}),300)},commentData=JSON.parse(localStorage.getItem("commentData"))||[],currentUser={},updatelocalstorage=function(){localStorage.setItem("commentData",JSON.stringify(commentData)),commentData=JSON.parse(localStorage.getItem("commentData"))},setCurrentUser=function(){currentUser=commentData.currentUser,userImgEl.src=currentUser.image.webp};0===commentData.length?fetch("./data.json").then((function(e){return e.json()})).then((function(e){commentData=e,localStorage.setItem("commentData",JSON.stringify(commentData)),setTimeout((function(){setCurrentUser(),renderComments()}))})).catch((function(e){return console.log("something went wrong",e)})):setTimeout((function(){setCurrentUser(),console.log(commentData.comments),renderComments()}));var renderComments=function(){commentsCtn.innerHTML="",console.log("working"),commentData.comments.forEach((function(e,t){var n=e.content,c=e.createdAt,o=e.replies,a=e.score,s=e.user;s.username!==currentUser.username?commentsCtn.innerHTML+='\n        \n        <section class="commentSection">\n           <div id="'.concat(t,'" class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4">\n               <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                   <img class="w-10" src="').concat(s.image.webp,'" alt="profile img avatar">\n                   <p class="username font-semibold">').concat(s.username,'</p>\n                   <p class="postedAt font-medium">').concat(c,'</p>\n               </div>\n               <p class="commentCard__comment">\n                   ').concat(n,'\n               </p>\n               <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n                   <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                   <i onclick="increaseScore(').concat(t,', this)" class="bi bi-plus"></i>\n                   <span class="count">').concat(a,'</span>\n                   <i onclick="decreaseScore(').concat(t,', this)" class="bi bi-dash"></i>\n                   </div>\n                   <div data-clicked="false" onclick="reply(this, ').concat(t,", false, '").concat(s.username,'\')" class="replyBtn flex items-center gap-x-1 font-medium lg:absolute top-7 right-10 cursor-pointer">\n                   <i class="bi bi-reply-fill"></i>\n                   <p>Reply</p>\n                   </div>\n               </div>\n           </div>\n   \n           ').concat(renderReplies(o,t),"\n   \n      </section>\n   \n        "):commentsCtn.innerHTML+='\n          <section class="commentSection">\n          \n          <div id="'.concat(t,'" class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto w-[95%] lg:w-[88%]">\n              <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                  <img class="w-10" src="').concat(s.image.webp,'" alt="user profile avatar">\n                  <p class="username font-semibold">').concat(s.username,'</p>\n                  <p class="you text-white px-2 ml-[-10px] text-sm">you</p>\n                  <p class="postedAt font-medium">').concat(c,'</p>\n              </div>\n          <p class="commentCard__comment">\n            ').concat(n,'\n          </p>\n          <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n          <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n              <i onclick="increaseScore(').concat(t,', this)" class="bi bi-plus"></i>\n              <span class="count">').concat(a,'</span>\n              <i onclick="decreaseScore(').concat(t,', this)" class="bi bi-dash"></i>\n          </div>\n          <div class="crudBtns flex items-center gap-x-3 lg:gap-x-5 font-medium lg:absolute top-7 right-10">\n              <div onclick="openModal(this)" class="delete flex items-center gap-x-1 text-red-500 cursor-pointer">\n              <i class="bi bi-trash-fill"></i>\n              <p>DELETE</p>\n              </div>\n              <div class="edit flex items-center gap-x-1 cursor-pointer">\n              <i class="bi bi-pen-fill"></i>\n              <p>EDIT</p>\n              </div>\n          </div>\n          </div>\n      </div>\n\n        ').concat(renderReplies(o,t),"\n    </section>\n        ")}))},renderReplies=function(e,t){var n="";return e.length>0&&(getSpaceBetweenElements(t),e.forEach((function(e,c){var o,a,s=e.content,l=e.createdAt,r=e.replyingTo,i=e.score,m=e.user;m.username!==currentUser.username?n+='\n            <section class="replySection">\n            \n            <div class="replyCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 w-[95%] lg:w-[88%]">\n                    '.concat(0===c?'\n                    <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n                    ':"",'\n                    <div class="replyCard__header flex items-center gap-x-4 pb-4">\n                        <img class="w-10" src="').concat(m.image.webp,'" alt="">\n                        <p class="username font-semibold">').concat(m.username,'</p>\n                        <p class="postedAt font-medium">').concat((o=l,a=new Date(o),a.getTime()==a.getTime()?formatDate(l):l),'</p>\n                    </div>\n                    <p class="replyCard__comment">\n                     <span class="replyTo font-bold pr-1">@').concat(r,"</span>").concat(s,'\n                    </p>\n                    <div class="replyCard__footer flex items-center justify-between mt-5 lg:block">\n                        <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                            <i onclick="increaseReplyScore(').concat(c,", '").concat(t,'\', this)" class="bi bi-plus"></i>\n                            <span class="count">').concat(i,'</span>\n                            <i onclick="decreaseReplyScore(').concat(c,", '").concat(t,'\', this)" class="bi bi-dash"></i>\n                        </div>\n                    <div data-clicked="false" onclick="reply(this, ').concat(t,", true, '").concat(m.username,'\')" class="replyBtn flex items-center gap-x-1 font-medium lg:absolute top-7 right-10 cursor-pointer">\n                        <i class="bi bi-reply-fill"></i>\n                        <p>Reply</p>\n                    </div>\n                  </div>\n           </div>\n\n            </section>\n            '):n+='\n            <div class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto w-[95%] lg:w-[88%]">\n            '.concat(0===c?'\n              <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n              ':"",'\n                <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                    <img class="w-10" src="').concat(m.image.webp,'" alt="user profile avatar">\n                    <p class="username font-semibold">').concat(m.username,'</p>\n                    <p class="you text-white px-2 ml-[-10px] text-sm">you</p>\n                    <p class="postedAt font-medium">').concat(l,'</p>\n                </div>\n                <p class="commentCard__comment">\n                <span class="replyTo font-bold pr-1">@').concat(r,"</span>").concat(s,'\n                </p>\n                <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n                <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                    <i onclick="increaseReplyScore(').concat(c,", '").concat(t,'\', this)" class="bi bi-plus"></i>\n                    <span class="count">').concat(i,'</span>\n                    <i  onclick="decreaseReplyScore(').concat(c,", '").concat(t,'\', this)" class="bi bi-dash"></i>\n                </div>\n                <div class="crudBtns flex items-center gap-x-3 lg:gap-x-5 font-medium lg:absolute top-7 right-10">\n                    <div onclick="openModal(this)" class="delete flex items-center gap-x-1 text-red-500 cursor-pointer">\n                        <i class="bi bi-trash-fill"></i>\n                        <p>DELETE</p>\n                    </div>\n                    <div onclick="edit(this)" class="edit flex items-center gap-x-1 cursor-pointer">\n                        <i class="bi bi-pen-fill"></i>\n                        <p>EDIT</p>\n                    </div>\n                </div>\n                </div>\n          </div>\n            ')}))),n},heights=[],getSpaceBetweenElements=function(e){var t,n,c,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;setTimeout((function(){var a=Array.from(document.querySelectorAll(".line"));t=document.getElementById("".concat(e)),n=e!==commentData.comments.length-1?t.parentElement.nextElementSibling:document.querySelector(".addComment"),c=n.offsetTop-(t.offsetTop+t.offsetHeight),heights.push(c);for(var s=0;s<heights.length;s++)a[s].style.height="".concat(heights[s]-o,"px")}))},increaseScore=function(e,t){var n=commentData.comments.find((function(t){return t.id===e+1}));n.score++,t.nextElementSibling.textContent=n.score,updatelocalstorage()},decreaseScore=function(e,t){var n=commentData.comments.find((function(t){return t.id===e+1}));n.score>0&&n.score--,t.previousElementSibling.textContent=n.score,updatelocalstorage()},increaseReplyScore=function(e,t,n){var c=commentData.comments[t].replies,o=c.find((function(t){return c.indexOf(t)===e}));o.score++,n.nextElementSibling.textContent=o.score,updatelocalstorage()},decreaseReplyScore=function(e,t,n){var c=commentData.comments[t].replies,o=c.find((function(t){return c.indexOf(t)===e}));o.score>0&&o.score--,n.previousElementSibling.textContent=o.score,updatelocalstorage()};window.addEventListener("resize",(function(){commentData.comments.forEach((function(e,t){var n=e.replies;heights=[],n.length>0&&getSpaceBetweenElements(t,45)}))}));var reply=function(e,t,n,c){var o='\n    <div class="addCommentCard bg-white px-5 lg:pr-4 rounded-xl flex flex-col lg:justify-end lg:flex-row gap-x-5 relative lg:pb-6 lg:pt-4 w-[95%] ml-auto lg:w-[88%] mt-5">\n        <textarea name="comment" id="'.concat(n?"replyInput":"replyToCommentInput",'" cols="30" rows="3" class="textArea w-full px-4 py-1 mt-5 lg:mt-4 rounded-lg lg:w-[70%]" placeholder="Add a comment...">@').concat(c+"",' </textarea>\n        <div class="footer flex justify-between items-center lg:block py-3">\n        <img class="w-10 lg:absolute left-5 top-8" src="').concat(currentUser.image.webp,'" alt="">\n        <button onclick="preRenderReply(this, \'').concat(c,"', ").concat(n,')" type="button" class="px-7 py-3 lg:py-2 lg:mt-1 text-white rounded-lg font-medium">REPLY</button>\n        </div>\n    </div>\n    '),a=(n?e.closest(".replySection"):e.closest(".commentSection")).lastElementChild;if("false"==e.getAttribute("data-clicked")){a.insertAdjacentHTML("afterend",o),getSpaceBetweenElements(t,45);var s=document.getElementById("".concat(n?"replyInput":"replyToCommentInput"));s.focus(),s.selectionStart=c.length+2,s.selectionEnd=c.length+2}e.setAttribute("data-clicked","true")},formatDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.language,n=function(e,t){return Math.round(Math.abs(t-e)/864e5)},c=n(new Date,e);switch(c){case 0:return"Today";case 1:return"Yesterday";case c<=7:return"1 week ago";case c<=14:return"2 weeks ago";case c<=21:return"3 weeks ago";case c<=30:return"1 month ago";case c<=60:return"2 months ago";case c<=90:return"3 months ago";default:return new Intl.DateTimeFormat(t).format(e)}},preRenderReply=function(e,t,n){var c,o=e.parentElement.previousElementSibling.value.trim();o=o.replace("@".concat(t),""),console.log(n),c=n?commentData.comments.find((function(e){return e.replies.find((function(e){return e.replyingTo==t}))})):commentData.comments.find((function(e){return e.user.username===t})),c.replies.push({content:o,createdAt:formatDate(new Date),score:0,replyingTo:t,user:{image:{png:"./images/avatars/image-juliusomo.png",webp:"./images/avatars/image-juliusomo.webp"},username:"juliusomo"}}),heights=[],updatelocalstorage(),renderComments()};