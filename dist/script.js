"use strict";var replyToDelete,modal=document.querySelector(".modal"),overlay=document.querySelector(".overlay"),body=document.querySelector("body"),commentsCtn=document.querySelector(".allCommentCtn"),userImgEl=document.querySelector("#currentUserImg"),heights=[],generateUniqueId=function(){return Date.now().toString(36)+Math.random().toString(36).substring(2,5)},openModal=function(e){modal.classList.add("fade-in"),overlay.classList.add("fade-in"),modal.style.display="block",overlay.style.display="block",body.classList.add("no-scroll"),overlay.addEventListener("click",closeModal)},closeModal=function(){modal.classList.add("fade-out"),overlay.classList.add("fade-out"),body.classList.remove("no-scroll"),setTimeout((function(){modal.style.display="none",overlay.style.display="none",modal.classList.remove("fade-out"),overlay.classList.remove("fade-out")}),300)},commentData=JSON.parse(localStorage.getItem("commentData"))||[],currentUser={},updatelocalstorage=function(){localStorage.setItem("commentData",JSON.stringify(commentData)),commentData=JSON.parse(localStorage.getItem("commentData"))},setCurrentUser=function(){currentUser=commentData.currentUser,userImgEl.src=currentUser.image.webp};0===commentData.length?fetch("./data.json").then((function(e){return e.json()})).then((function(e){commentData=e,localStorage.setItem("commentData",JSON.stringify(commentData)),setTimeout((function(){setCurrentUser(),renderComments()}))})).catch((function(e){return console.log("something went wrong",e)})):setTimeout((function(){setCurrentUser(),console.log(commentData.comments),renderComments()}));var renderComments=function(){commentsCtn.innerHTML="",commentData.comments.forEach((function(e,t){var n=e.content,a=e.createdAt,o=e.replies,c=e.score,s=e.upvoted,l=e.downvoted,i=e.user;if(i.username!==currentUser.username)commentsCtn.innerHTML+='\n        \n        <section class="commentSection overflow-hidden">\n           <div id="'.concat(t,'" class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4">\n               <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                   <img class="w-10" src="').concat(i.image.webp,'" alt="profile img avatar">\n                   <p class="username font-semibold">').concat(i.username,'</p>\n                   <p class="postedAt font-medium">').concat(a,'</p>\n               </div>\n               <p class="commentCard__comment">\n                   ').concat(n,'\n               </p>\n               <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n                   <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                   <i onclick="increaseScore(').concat(t,", this, ").concat(s,')" class="bi bi-plus"></i>\n                   <span class="count">').concat(c,'</span>\n                   <i onclick="decreaseScore(').concat(t,", this, ").concat(l,')" class="bi bi-dash"></i>\n                   </div>\n                   <div data-clicked="false" onclick="reply(this, ').concat(t,", false, '").concat(i.username,'\')" class="replyBtn flex items-center gap-x-1 font-medium lg:absolute top-7 right-10 cursor-pointer">\n                   <i class="bi bi-reply-fill"></i>\n                   <p>Reply</p>\n                   </div>\n               </div>\n           </div>\n   \n           ').concat(renderReplies(o,t),"\n   \n      </section>\n   \n        ");else{var r=t+1;commentsCtn.innerHTML+='\n          <section class="commentSection">\n          \n          <div id="'.concat(t,'" class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto">\n              <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                  <img class="w-10" src="').concat(i.image.webp,'" alt="user profile avatar">\n                  <p class="username font-semibold">').concat(i.username,'</p>\n                  <p class="you text-white px-2 ml-[-10px] text-sm">you</p>\n                  <p class="postedAt font-medium">').concat(isDate(a)?formatDate(a):a,'</p>\n              </div>\n          <p class="commentCard__comment">\n            ').concat(n,'\n          </p>\n          <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n          <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n              <i onclick="increaseScore(').concat(t,", this, ").concat(s,')" class="bi bi-plus"></i>\n              <span class="count">').concat(c,'</span>\n              <i onclick="decreaseScore(').concat(t,", this, ").concat(l,')" class="bi bi-dash"></i>\n          </div>\n          <div class="crudBtns flex items-center gap-x-3 lg:gap-x-5 font-medium lg:absolute top-7 right-10">\n              <div onclick="DELETE(this, ').concat(t,", false, ").concat(r,')" class="delete flex items-center gap-x-1 text-red-500 cursor-pointer">\n              <i class="bi bi-trash-fill"></i>\n              <p>DELETE</p>\n              </div>\n              <div onclick="edit(this, ').concat(t,", ").concat(c,', false)" class="edit flex items-center gap-x-1 cursor-pointer">\n              <i class="bi bi-pen-fill"></i>\n              <p>EDIT</p>\n              </div>\n          </div>\n          </div>\n      </div>\n\n        ').concat(renderReplies(o,t),"\n    </section>\n        ")}})),commentData.comments.forEach((function(e,t){e.replies.length>0&&(getSpaceBetweenElements(t),heights=[])}))},isDate=function(e){var t=new Date(e);return t.getTime()==t.getTime()},renderReplies=function(e,t){var n="";return e.length>0&&e.forEach((function(e,a){var o=e.id,c=e.content,s=e.createdAt,l=e.replyingTo,i=e.score,r=e.upvoted,m=e.downvoted,d=e.user;d.username!==currentUser.username?n+='\n            <section class="replySection">\n            \n            <div class="replyCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 w-[95%] lg:w-[88%]">\n                    '.concat(0===a?'\n                    <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n                    ':"",'\n                    <div class="replyCard__header flex items-center gap-x-4 pb-4">\n                        <img class="w-10" src="').concat(d.image.webp,'" alt="">\n                        <p class="username font-semibold">').concat(d.username,'</p>\n                        <p class="postedAt font-medium">').concat(isDate(s)?formatDate(s):s,'</p>\n                    </div>\n                    <p class="replyCard__comment">\n                     <span class="replyTo font-bold pr-1">@').concat(l,"</span>").concat(c,'\n                    </p>\n                    <div class="replyCard__footer flex items-center justify-between mt-5 lg:block">\n                        <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                            <i onclick="increaseReplyScore(').concat(a,", '").concat(t,"', this, ").concat(r,')" class="bi bi-plus"></i>\n                            <span class="count">').concat(i,'</span>\n                            <i onclick="decreaseReplyScore(').concat(a,", '").concat(t,"', this, ").concat(m,')" class="bi bi-dash"></i>\n                        </div>\n                    <div data-clicked="false" onclick="reply(this, ').concat(t,", true, '").concat(d.username,'\')" class="replyBtn flex items-center gap-x-1 font-medium lg:absolute top-7 right-10 cursor-pointer">\n                        <i class="bi bi-reply-fill"></i>\n                        <p>Reply</p>\n                    </div>\n                  </div>\n           </div>\n\n            </section>\n            '):n+='\n            <div class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto w-[95%] lg:w-[88%]">\n            '.concat(0===a?'\n              <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n              ':"",'\n                <div class="commentCard__header flex items-center gap-x-4 pb-4">\n                    <img class="w-10" src="').concat(d.image.webp,'" alt="user profile avatar">\n                    <p class="username font-semibold">').concat(d.username,'</p>\n                    <p class="you text-white px-2 ml-[-10px] text-sm">you</p>\n                    <p class="postedAt font-medium">').concat(s,'</p>\n                </div>\n                <p class="commentCard__comment">\n                <span class="replyTo font-bold pr-1">@').concat(l,"</span>").concat(c,'\n                </p>\n                <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n                <div class="score flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n                    <i onclick="increaseReplyScore(').concat(a,", '").concat(t,"', this, ").concat(r,')" class="bi bi-plus"></i>\n                    <span class="count">').concat(i,'</span>\n                    <i  onclick="decreaseReplyScore(').concat(a,", '").concat(t,"', this, ").concat(m,')" class="bi bi-dash"></i>\n                </div>\n                <div class="crudBtns flex items-center gap-x-3 lg:gap-x-5 font-medium lg:absolute top-7 right-10">\n                    <div onclick="DELETE(this, ').concat(t,", ").concat(a,", '").concat(o,'\')" class="delete flex items-center gap-x-1 text-red-500 cursor-pointer">\n                        <i class="bi bi-trash-fill"></i>\n                        <p>DELETE</p>\n                    </div>\n                    <div onclick="edit(this, ').concat(t,", ").concat(a,", ").concat(i,", '").concat(isDate(s)?formatDate(s):s,"', '").concat(l,'\', true)" class="edit flex items-center gap-x-1 cursor-pointer">\n                        <i class="bi bi-pen-fill"></i>\n                        <p>EDIT</p>\n                    </div>\n                </div>\n                </div>\n          </div>\n            ')})),n},getSpaceBetweenElements=function(e){var t,n,a,o=commentData.comments.length;setTimeout((function(){commentData.comments.forEach((function(e,t){0==e.replies.length&&o--}));var c=Array.from(document.querySelectorAll(".line"));t=document.getElementById("".concat(e)),n=e!==commentData.comments.length-1?t.parentElement.nextElementSibling:document.querySelector(".addComment"),a=n.offsetTop-(t.offsetTop+t.offsetHeight),heights.push(a),console.log(heights);for(var s=0;s<o;s++)c[s].style.height="".concat(heights[s],"px")}))},increaseScore=function(e,t,n){var a=commentData.comments.find((function(t){return t.id===e+1}));a.upvoted=!0,!n&&a.score++,a.downvoted=!1,t.nextElementSibling.textContent=a.score,updatelocalstorage(),heights=[],!n&&renderComments()},decreaseScore=function(e,t,n){var a=commentData.comments.find((function(t){return t.id===e+1}));a.downvoted=!0,!n&&a.score>0&&a.score--,a.upvoted=!1,t.previousElementSibling.textContent=a.score,updatelocalstorage(),heights=[],!n&&renderComments()},increaseReplyScore=function(e,t,n,a){var o=commentData.comments[t].replies,c=o.find((function(t){return o.indexOf(t)===e}));c.upvoted=!0,!a&&c.score++,c.downvoted=!1,n.nextElementSibling.textContent=c.score,updatelocalstorage(),heights=[],!a&&renderComments()},decreaseReplyScore=function(e,t,n,a){var o=commentData.comments[t].replies,c=o.find((function(t){return o.indexOf(t)===e}));c.downvoted=!0,!a&&c.score>0&&c.score--,c.upvoted=!1,n.previousElementSibling.textContent=c.score,updatelocalstorage(),heights=[],!a&&renderComments()};window.addEventListener("resize",(function(){commentData.comments.forEach((function(e,t){heights=[],e.replies.length>0&&getSpaceBetweenElements(t)}))}));var replyToUpdate,inputValue,reply=function(e,t,n,a){var o;heights=[],o=n?e.closest(".replySection"):e.closest(".commentSection");var c=Array.from(o.children).length-1,s='\n    <div class="addCommentCard bg-white px-5 lg:pr-4 rounded-xl flex flex-col lg:justify-end lg:flex-row gap-x-5 relative lg:pb-6 lg:pt-4 w-[95%] ml-auto lg:w-[88%] mt-5">\n        '.concat(0===c?'\n        <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n        ':"",'\n        <textarea name="comment" id="').concat(n?"replyInput":"replyToCommentInput",'" cols="30" rows="3" class="textArea w-full px-4 py-1 mt-5 lg:mt-4 rounded-lg lg:w-[70%]" placeholder="Add a comment...">@').concat(a+"",' </textarea>\n        <div class="footer flex justify-between items-center lg:block py-3">\n        <img class="w-10 lg:absolute left-5 top-8" src="').concat(currentUser.image.webp,'" alt="">\n        <button onclick="preRenderReply(this, \'').concat(a,"', ").concat(n,')" type="button" class="px-7 py-3 lg:py-2 lg:mt-1 text-white rounded-lg font-medium">REPLY</button>\n        </div>\n    </div>\n    '),l=o.lastElementChild;if("false"==e.getAttribute("data-clicked")){l.insertAdjacentHTML("afterend",s),commentData.comments.forEach((function(e,t){e.replies.length>0&&getSpaceBetweenElements(t)}));var i=document.getElementById("".concat(n?"replyInput":"replyToCommentInput"));i.focus(),i.selectionStart=a.length+2,i.selectionEnd=a.length+2}e.setAttribute("data-clicked","true")},formatDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:navigator.language,n=function(e,t){return Math.round(Math.abs(t-e)/864e5)},a=n(new Date,e);switch(a){case 0:return"Today";case 1:return"Yesterday";case a<=7:return"1 week ago";case a<=14:return"2 weeks ago";case a<=21:return"3 weeks ago";case a<=30:return"1 month ago";case a<=60:return"2 months ago";case a<=90:return"3 months ago";default:return new Intl.DateTimeFormat(t).format(e)}},preRenderReply=function(e,t,n){heights=[];var a,o=e.parentElement.previousElementSibling.value.trim();o=o.replace("@".concat(t),""),console.log(n),a=n?commentData.comments.find((function(e){return e.replies.find((function(e){return e.replyingTo==t}))})):commentData.comments.find((function(e){return e.user.username===t})),a.replies.push({id:generateUniqueId(),content:o.trim(),createdAt:formatDate(new Date),score:0,replyingTo:t,user:{image:{png:"./images/avatars/image-juliusomo.png",webp:"./images/avatars/image-juliusomo.webp"},username:"juliusomo"}}),updatelocalstorage(),renderComments()},edit=function(e,t,n,a,o,c,s){var l=commentData.comments.find((function(e){return e.id===t+1})),i=l.replies,r=i.find((function(e){return i.indexOf(e)===n}));replyToUpdate=r,inputValue=e.parentElement.parentElement.previousElementSibling.textContent.trim().replace("@".concat(c),"");var m,d=e.closest(".commentCard"),p=e.closest(".commentSection");if(s)m='\n    <div class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto w-[95%] lg:w-[88%]">\n      '.concat(0===n?'\n      <span id="line" class="block line absolute top-0 w-[2px] left-[-.95rem] lg:left-[-3rem] bg-slate-300"></span>\n      ':"",'\n      <div class="commentCard__header flex items-center gap-x-4 pb-4">\n      <img class="w-10" src="').concat(currentUser.image.webp,'" alt="user profile avatar">\n        <p class="username font-semibold">juliosumo</p>\n        <p class="you text-white px-2 ml-[-10px] text-sm bg-blue">you</p>\n        <p class="postedAt font-medium">').concat(o,'</p>\n        </div>\n      <textarea oninput="validateInput(this)" name="comment" id="update" cols="30" rows="4" class="w-full px-4 py-2 rounded-lg mb-3 lg:mb-0">@').concat(c," ").concat(inputValue,'</textarea>\n      <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n        <div class="score bg-grey flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n          <i class="bi bi-plus"></i>\n          <span class="count">').concat(a,'</span>\n          <i class="bi bi-dash"></i> \n        </div>\n          <div class="updateBtn lg:text-right">\n            <button disabled onclick="update(this, \'').concat(c,'\')" id="updateBtn" class="px-7 py-3 lg:py-2 lg:mt-1 text-white rounded-lg font-medium disabled:opacity-30 disabled:pointer-events-none">UPDATE</button>\n          </div>\n        </div>\n      </div>\n   </div>\n    ');else{var u=l.createdAt,g=l.score,f=l.id;m='\n    <div class="commentCard bg-white rounded-xl p-5 relative lg:pr-20 lg:pl-24 lg:pb-4 mt-5 ml-auto">\n\n      <div class="commentCard__header flex items-center gap-x-4 pb-4">\n      <img class="w-10" src="'.concat(currentUser.image.webp,'" alt="user profile avatar">\n        <p class="username font-semibold">juliosumo</p>\n        <p class="you text-white px-2 ml-[-10px] text-sm bg-blue">you</p>\n        <p class="postedAt font-medium">').concat(u,'</p>\n        </div>\n      <textarea oninput="validateInput(this)" name="comment" id="update" cols="30" rows="4" class="w-full px-4 py-2 rounded-lg mb-3 lg:mb-0"> ').concat(inputValue,'</textarea>\n      <div class="commentCard__footer flex items-center justify-between mt-5 lg:block">\n        <div class="score bg-grey flex items-center gap-x-3 font-medium rounded-lg px-4 py-2 lg:absolute left-7 lg:flex-col top-5 lg:py-4 lg:px-3">\n          <i class="bi bi-plus"></i>\n          <span class="count">').concat(g,'</span>\n          <i class="bi bi-dash"></i> \n        </div>\n          <div class="updateBtn lg:text-right">\n            <button data-commentId="').concat(f,'" disabled onclick="update(this, false)" id="updateBtn" class="px-7 py-3 lg:py-2 lg:mt-1 text-white rounded-lg font-medium disabled:opacity-30 disabled:pointer-events-none">UPDATE</button>\n          </div>\n        </div>\n      </div>\n   </div>\n    ')}heights=[],d.remove(),p.insertAdjacentHTML("beforeend",m),commentData.comments.forEach((function(e,t){e.replies.length>0&&getSpaceBetweenElements(t)}));var v=document.getElementById("update");v.focus(),v.selectionStart=v.value.length+1,v.selectionEnd=v.value.length+1},validateInput=function(e){var t=document.getElementById("updateBtn");e.value===inputValue?t.disabled=!0:t.disabled=!1},update=function(e,t){var n;if(heights=[],!1!==t)n=e.parentElement.parentElement.previousElementSibling.value.trim().replace("@".concat(t),""),replyToUpdate.content=n,replyToUpdate.createdAt=formatDate(new Date);else{n=e.parentElement.parentElement.previousElementSibling.value.trim();var a=+e.getAttribute("data-commentId"),o=commentData.comments.find((function(e){return e.id===a}));o.content=n,o.createdAt=formatDate(new Date)}updatelocalstorage(),renderComments()},DELETE=function(e,t,n,a){var o=commentData.comments.find((function(e){return e.id===t+1})).replies,c=o.findIndex((function(e){return e.id===a}));(console.log(c),n&&-1===c)||(openModal(),document.getElementById("deleteBtn").addEventListener("click",(function(){if(-1!==c)e.parentElement.parentElement.parentElement.remove(),o.splice(c,1);else{var t=a-1;console.log(t),commentData.comments.splice(t,1),e.parentElement.parentElement.parentElement.remove()}setTimeout((function(){updatelocalstorage(),renderComments()})),closeModal()})))},commentInput=document.querySelector(".addCommentInput"),addComment=function(e){var t=commentInput.value.trim(),n=commentData.comments.length+1;""!==t&&(commentData.comments.push({id:n,content:t,createdAt:formatDate(new Date),score:0,upvoted:!1,downvoted:!1,user:{image:{png:"./images/avatars/image-juliusomo.png",webp:"./images/avatars/image-juliusomo.webp"},username:"juliusomo"},replies:[]}),commentInput.value="",setTimeout((function(){updatelocalstorage(),renderComments()})),console.log(commentData.comments))};